import{V as e}from"./index-qFWBhN92.js";import{r as a,O as l,aB as t,d as s,o,c as n,F as i,e as u,n as r,a as p,k as v,m as c,aO as d,h as m,_ as f,ah as k,w as _,aP as b,l as h,g as w,az as y,aE as x,aQ as C}from"./index-Ch1CAwop.js";import{F as g}from"./FileSelector-B2cmxcS2.js";import"./index.vue_vue_type_style_index_0_lang-B6do1Ahd.js";const E=()=>{const e=a(!1);return(e=>{const a=a=>{if(e())return a.preventDefault(),a.returnValue="There is unsaved data.",!0};l((()=>{window.addEventListener("beforeunload",a)})),t((()=>{window.removeEventListener("beforeunload",a)}))})((()=>e.value)),{isChanged:e}},F={key:0,class:"quick-menu-strip"},P={key:0,class:"option-split"},S=["onClick"],T=f(s({__name:"QuickMenuStrip",props:{options:{}},emits:[],setup(e,{emit:l}){const t=a(),s=a([]),f=a(-1),k=()=>{s.value=[],f.value=-1};return(e,a)=>e.options&&e.options.length?(o(),n("div",F,[(o(!0),n(i,null,u(e.options,((e,a)=>(o(),n(i,{key:a},[e.split?(o(),n("div",P)):(o(),n("button",{key:1,class:r(["btn-no-style btn-menu",{active:p(f)===a}]),onClick:l=>((e,a,l)=>{t.value.showMenuByElement(e.target,"bottom-left"),setTimeout((()=>{s.value=a.children||[],f.value=l}))})(l,e,a)},v(e.label),11,S))],64)))),128)),c(d,{ref_key:"verticalMenuRef",ref:t,onOnClose:k,options:p(s)},null,8,["options"])])):m("",!0)}}),[["__scopeId","data-v-287c6aba"]]),O=f(s({name:"TextEditor",props:{task:{},appParams:{}},emits:[],setup(t,{emit:s}){const i=t,u=s,{task:r}=k(i),v=a(""),d=a(""),{isChanged:m}=E();_(d,(()=>{m.value=!0})),_(m,(e=>{r.value&&(r.value.title=e?`* ${v.value}`:`${v.value}`)}));const f=async e=>{console.log(e);const{item:a,basePath:l}=e;v.value=y(l+"/"+a.name),d.value=await x.readFile(v.value),setTimeout((()=>{m.value=!1}))};l((()=>{i.appParams&&f(i.appParams)}));const F=a(),P=a();b(P,(()=>{F.value.resize()}));const S=a(),O=h((()=>[{label:"File",children:[{label:"New",props:{onClick(){d.value="",v.value="",setTimeout((()=>{m.value=!1}))}}},{label:"Open...",props:{onClick(){S.value.show()}}},v.value&&{label:"Save",props:{onClick(){(async()=>{if(!v.value)throw new Error("editFullPath not exist!");const e=v.value.lastIndexOf("/")+1,a=v.value.slice(e);await x.uploadFile({path:v.value,file:C(d.value,a)}),setTimeout((()=>{m.value=!1}))})()}}},{label:"Save As...",props:{onClick(){}}},{split:!0},{label:"Exit!",props:{onClick(){u("exitApp")}}}].filter(Boolean)}]));return(a,l)=>(o(),n("div",{class:"text-editor-wrap",ref_key:"rootRef",ref:P},[c(T,{options:p(O)},null,8,["options"]),c(g,{"show-button":!1,ref_key:"fileSelectorRef",ref:S,onHandleSelect:f},null,512),c(e,{modelValue:p(d),"onUpdate:modelValue":l[0]||(l[0]=e=>w(d)?d.value=e:null),ref_key:"vueMonacoRef",ref:F},null,8,["modelValue"])],512))}}),[["__scopeId","data-v-5d8d96f4"]]);export{O as default};
