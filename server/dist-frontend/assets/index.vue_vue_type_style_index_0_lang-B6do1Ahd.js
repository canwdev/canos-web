import{d as e,ah as a,r as t,O as l,N as s,U as n,o as i,c as o,b as r,a as c,n as d,ae as p,F as u,e as v,k as h,aF as f,h as m,aE as b,aR as y,az as k,aS as g,w,l as C,aJ as P,f as F,v as S,g as x,ai as R,B as O,C as _,aT as D,m as L,aU as U}from"./index-Ch1CAwop.js";const $={key:0,class:"mdi mdi-chevron-right"},A={key:1,class:"mdi mdi-chevron-left"},B={class:"file-sidebar-content"},K=["title","onClick"],M={class:"drive-icon"},E={class:"drive-content"},I={class:"drive-title text-overflow"},H={key:0,class:"volume-bar"},T=e({__name:"FileSidebar",props:{width:{default:"160px"},currentPath:{}},emits:["openDrive"],setup(e,{expose:g,emit:w}){const C=e,{currentPath:P}=a(C),F=w,S=t(!1),x=t([]),R=async()=>{try{S.value=!0;const e=await b.getDrives({});x.value=e.map((e=>{return{...e,path:(a=e.path,a=k(a),/\/$/gi.test(a)||(a+="/"),a)};var a}))}catch(e){console.error(e),x.value=[]}finally{S.value=!1}};l((()=>{R()}));const O=e=>"home"===e.label.toLowerCase()?"mdi-home-account":"data"===e.label.toLowerCase()?"mdi-folder-pound-outline":e.total?"mdi-harddisk":"mdi-folder-outline",_=s(n.EXPLORER_SHOW_SIDEBAR,!0),D=e=>{let a=`Path: ${e.path}`;return e.total&&(a+=`\nUsed: ${(e.free/e.total*100).toFixed(0)+"%"}\nStorage: ${y(e.free)} / ${y(e.total)}\n`),a};return g({handleRefresh:R,openFirstDrive:()=>{x.value[0]&&F("openDrive",x.value[0])}}),(e,a)=>(i(),o("div",{class:"explorer-file-sidebar",style:f({width:c(_)?e.width:"0"})},[r("button",{class:d(["btn-toggle btn-no-style",{_folded:!c(_)}]),onClick:a[0]||(a[0]=e=>_.value=!c(_))},[c(_)?(i(),o("span",A)):(i(),o("span",$))],2),p(e.$slots,"default"),r("div",B,[(i(!0),o(u,null,v(c(x),((e,a)=>(i(),o("button",{class:d(["drive-item btn-no-style",{active:e.path===c(P)}]),key:a,title:D(e),onClick:a=>(e=>{e.path!==P.value&&F("openDrive",e)})(e)},[r("span",M,[r("span",{class:d(["mdi",O(e)])},null,2)]),r("span",E,[r("span",I,h(e.label),1),e.total?(i(),o("span",H,[r("span",{style:f({width:e.free/e.total*100+"%"}),class:"volume-value"},null,4)])):m("",!0)])],10,K)))),128))])],4))}}),z={key:0,class:"explorer-header vp-panel"},N={class:"nav-address"},V={class:"nav-wrap"},j=["disabled"],J=[r("span",{class:"mdi mdi-arrow-left"},null,-1)],W=["disabled"],X=[r("span",{class:"mdi mdi-arrow-right"},null,-1)],q=["disabled"],G=[r("span",{class:"mdi mdi-arrow-up"},null,-1)],Q=[r("span",{class:"mdi mdi-refresh"},null,-1)],Y={key:0,class:"mdi mdi-star"},Z={key:1,class:"mdi mdi-star-outline"},ee={class:"explorer-content-wrap scrollbar-mini"},ae={key:0,class:"file-sidebar-content star-list"},te=["onClick","title","onContextmenu"],le=r("span",{class:"drive-icon"},[r("span",{class:"mdi mdi-star"})],-1),se={class:"drive-content"},ne={class:"drive-title text-overflow"},ie={key:1,class:"vp-bg explorer-bottom-wrap"},oe=e({name:"FileManager",props:{task:{},appParams:{},selectFileMode:{},multiple:{type:Boolean,default:!1},contentOnly:{type:Boolean,default:!1}},emits:["handleSelect","cancelSelect"],setup(e,{expose:s,emit:n}){const d=e,p=n,{task:f,selectFileMode:y,multiple:k}=a(d),{isLoading:$,filteredFiles:A,handleOpen:B,handleRefresh:K,basePathNormalized:M,starList:E,handleOpenPath:I,backHistory:H,goBack:oe,forwardHistory:re,goForward:ce,allowUp:de,goUp:pe,basePath:ue,toggleStar:ve,isStared:he,filterText:fe}=g({getListFn:async()=>await b.getList({path:ue.value})});w((()=>d.appParams),(()=>{if(!d.appParams)return;const{path:e}=d.appParams;e&&I(e)}),{immediate:!0}),w(M,(e=>{f.value&&(f.value.title=(e||"").replace(/\/$/,"").split("/").pop())}),{immediate:!0});const me=t();l((async()=>{var e;me.value&&(await me.value.handleRefresh(),(null==(e=d.appParams)?void 0:e.path)||me.value.openFirstDrive())}));const be=e=>{if("file"!==y.value||e.isDirectory)return B(e);p("handleSelect",{items:[e],item:e,basePath:ye.value.basePath})},ye=t(),ke=C((()=>{let e=ye.value.selectedItems;return 1===e.length&&e[0].isDirectory})),ge=()=>{let e=ye.value.selectedItems;if(ke.value)B(e[0]);else if("folder"===y.value&&p("handleSelect",{basePath:ye.value.basePath}),e.length)if("file"!==y.value);else{if(e=e.filter((e=>!e.isDirectory)),!e.length)return;p("handleSelect",{items:e,item:e[0],basePath:ye.value.basePath})}},we=t(),Ce=t(),Pe=t();return s({handleShortcutKey:e=>{var a;const t=null==(a=e.key)?void 0:a.toLowerCase();e.altKey&&("a"===t?Ce.value&&Ce.value.focus():"f"===t?Pe.value&&Pe.value.focus():"s"===t?ve():"ArrowUp"===e.key?pe():"ArrowLeft"===e.key?oe():"ArrowRight"===e.key&&ce()),ye.value.handleShortcutKey(e)}}),(e,a)=>(i(),o("div",{ref_key:"rootRef",ref:we,class:"explorer-wrap"},[e.contentOnly?m("",!0):(i(),o("div",z,[r("div",N,[r("div",V,[r("button",{disabled:c(H).length<=1,class:"btn-action btn-no-style",onClick:a[0]||(a[0]=(...e)=>c(oe)&&c(oe)(...e)),title:"Back (alt+left)"},J,8,j),r("button",{disabled:c(re).length<=0,class:"btn-action btn-no-style",onClick:a[1]||(a[1]=(...e)=>c(ce)&&c(ce)(...e)),title:"Forward (alt+right)"},X,8,W),r("button",{class:"btn-action btn-no-style",disabled:!c(de),onClick:a[2]||(a[2]=(...e)=>c(pe)&&c(pe)(...e)),title:"Up (alt+up)"},G,8,q)]),r("div",{class:"input-wrap",onKeydown:a[10]||(a[10]=P((()=>{}),["stop"]))},[F(r("input",{ref_key:"inputAddrRef",ref:Ce,placeholder:"Path","onUpdate:modelValue":a[3]||(a[3]=e=>x(ue)?ue.value=e:null),class:"input-addr vp-input",onKeyup:a[4]||(a[4]=R(((...e)=>c(K)&&c(K)(...e)),["enter"])),onChange:a[5]||(a[5]=(...e)=>c(K)&&c(K)(...e)),title:"Address bar (alt+a)"},null,544),[[S,c(ue)]]),r("button",{class:"btn-no-style btn-action",title:"Refresh (ctrl+r)",onClick:a[6]||(a[6]=(...e)=>c(K)&&c(K)(...e))},Q),r("button",{class:"btn-no-style btn-action",onClick:a[7]||(a[7]=(...e)=>c(ve)&&c(ve)(...e)),title:"Toggle Star (alt+s)"},[c(he)?(i(),o("span",Y)):(i(),o("span",Z))]),F(r("input",{ref_key:"searchInputRef",ref:Pe,placeholder:"Filter name","onUpdate:modelValue":a[8]||(a[8]=e=>x(fe)?fe.value=e:null),onKeyup:a[9]||(a[9]=R((e=>fe.value=""),["esc"])),class:"input-filter vp-input",title:"Filter bar (alt+f)"},null,544),[[S,c(fe)]])],32)])])),r("div",ee,[e.contentOnly?m("",!0):(i(),O(T,{key:0,ref_key:"fileSidebarRef",ref:me,onOpenDrive:a[11]||(a[11]=e=>c(I)(e.path)),"current-path":c(ue)},{default:_((()=>[c(E).length?(i(),o("div",ae,[(i(!0),o(u,null,v(c(E),((e,a)=>(i(),o("div",{key:e},[r("button",{onClick:a=>c(I)(e),class:"drive-item btn-no-style",title:e,onContextmenu:P((()=>c(E).splice(a,1)),["prevent"])},[le,r("span",se,[r("span",ne,h(c(D)(e)),1)])],40,te)])))),128))])):m("",!0)])),_:1},8,["current-path"])),L(U,{ref_key:"fileListRef",ref:ye,"is-loading":c($),"onUpdate:isLoading":a[12]||(a[12]=e=>x($)?$.value=e:null),files:c(A),onOpen:be,onRefresh:c(K),"base-path":c(M),selectFileMode:c(y),multiple:c(k),"content-only":e.contentOnly},null,8,["is-loading","files","onRefresh","base-path","selectFileMode","multiple","content-only"])]),c(y)&&c(ye)?(i(),o("div",ie,[r("button",{class:"vp-button primary",onClick:ge},h("file"===c(y)||c(ke)?"Open":"Select Folder"),1),r("button",{class:"vp-button",onClick:a[13]||(a[13]=a=>e.$emit("cancelSelect"))},"Cancel")])):m("",!0)],512))}});export{oe as _};
