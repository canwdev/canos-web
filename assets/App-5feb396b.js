import{aI as W,d as z,r as D,bh as p,c as R,o as J,j as K,aE as m,aF as g,aG as a,aK as B,aj as b,cj as U,$ as M,aJ as H,ck as N,aL as j}from"./index-3cde8b9e.js";import{b as P,a as T,c as Q}from"./use-local-storage-24211ff8.js";function X(e){let o=document.createElement("canvas");o.width=e.videoWidth,o.height=e.videoHeight,o.getContext("2d").drawImage(e,0,0,e.videoWidth,e.videoHeight);const r=o.toDataURL("image/png"),n=document.createElement("a");n.download="video-screenshot.png",n.href=r,n.click()}class Y{constructor(o,r,n=1e3){this.timeoutID=null,this.targetEl=document.querySelector(o),this.showHideFn=r,this.time=n,this.showCursor=this.showCursor.bind(this),this.start()}hideCursor(){typeof this.showHideFn=="function"?this.showHideFn({el:this.targetEl,isShow:!1}):this.targetEl.style.cursor="none"}showCursor(){typeof this.showHideFn=="function"?this.showHideFn({el:this.targetEl,isShow:!0}):this.targetEl.style.cursor="",this.runTimer()}runTimer(){clearTimeout(this.timeoutID),this.timeoutID=setTimeout(()=>{this.hideCursor()},this.time)}start(){document.addEventListener("mousemove",this.showCursor),this.runTimer()}stop(){document.removeEventListener("mousemove",this.showCursor),clearTimeout(this.timeoutID)}}async function Z(){var e;if((e=navigator.mediaDevices)!=null&&e.enumerateDevices)return await navigator.mediaDevices.enumerateDevices();throw new Error("enumerateDevices() not supported.")}const x=z({setup(){const e=D(!1),o=P("ls_key_is_show_controls",!1),r=D([]),n=D(),v=T("ls_key_video_device_id",""),h=T("ls_key_audio_device_id",""),t=Q("ls_key_video_config"),f=p(),I=(s,i)=>s.filter(l=>l.kind===i&&!!l.deviceId),E=R(()=>I(r.value,"videoinput")),$=R(()=>I(r.value,"audioinput")),w=async()=>{try{e.value=!0,r.value=await Z()}catch(s){console.error(s),alert("Error: "+s.message)}finally{e.value=!1}},k=()=>{navigator.mediaDevices.ondevicechange=async()=>{await w()}},S=p(),L=p(),_=p();J(async()=>{S.value=new Y("#app",({el:s,isShow:i})=>{const l=L.value;i?(s.style.cursor="",l.classList.add("visible")):(s.style.cursor="none",l.classList.remove("visible"))},3e3);try{if(v.value||h.value){await F(),await w(),k();return}try{f.value=await navigator.mediaDevices.getUserMedia({audio:!0}),d()}catch(s){console.warn("getUserMedia audio Error:",s)}try{f.value=await navigator.mediaDevices.getUserMedia({video:!0}),d()}catch(s){console.warn("getUserMedia video Error:",s)}await w(),k()}catch(s){console.error(s),alert("Error: "+s.message)}}),K(()=>{S.value&&S.value.stop(),d()});const F=async()=>{try{e.value=!0;const i=v.value,l=h.value;let c=!1;if(i)if(!t.value||t.value.deviceId!==i){const C=E.value.find(u=>u.deviceId===i);if(console.log(C),C){const u=C.getCapabilities();c=t.value={deviceId:u.deviceId,height:u.height.max,width:u.width.max,frameRate:u.frameRate.max}}else c={deviceId:i}}else c=t.value;var s={audio:l?{deviceId:l,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1}:!1,video:c};const V=await navigator.mediaDevices.getUserMedia(s);f.value=V;const y=n.value;y.srcObject=V,y.onloadedmetadata=()=>{y.play()}}catch(i){console.error(i),alert("Error: "+i.message)}finally{e.value=!1}},O=()=>{d(),F()},d=()=>{const s=n.value;s.pause(),s.srcObject=null;const i=f.value;if(!i)return;i.getTracks().forEach(c=>{c.readyState=="live"&&c.stop()})},G=()=>{d(),v.value="",h.value="",t.value=null};function A(s=!1){const i=_.value.closest(".vp-window");i&&(s?i.classList.add("_fullscreen_content"):i.classList.remove("_fullscreen_content"))}function q(){document.fullscreenElement?document.exitFullscreen&&(document.exitFullscreen(),A(!1)):(document.documentElement.requestFullscreen(),A(!0))}return{videoRef:n,deviceList:r,currentVideoDeviceId:v,videoDeviceList:E,currentAudioDeviceId:h,audioDeviceList:$,handleStart:O,stopBothVideoAndAudio:d,clearSelect:G,isLoading:e,isShowControls:o,toggleFullScreen:q,handleStartCaptureScreen:async()=>{try{e.value=!0,d();const s=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"window"},audio:!0});f.value=s;const i=n.value;i.srcObject=s,i.onloadedmetadata=()=>{i.play()}}catch(s){console.error(s),alert("Error: "+s.message)}finally{e.value=!1}},handleScreenshot:()=>{X(n.value)},actionBarRef:L,rootRef:_}}}),ee={ref:"rootRef",class:"web-mediadevices-player"},te={class:"action-bar-wrap"},oe={class:"action-bar-side"},se={for:"videoSelect"},ie=a("span",null,"Video:",-1),ae=["value"],ne={for:"audioSelect"},re=a("span",null,"Audio:",-1),le=["value"],de={for:"toggleControls"},ce=a("span",null,"Controls",-1),ue=a("div",null,[a("a",{href:"https://github.com/canwdev/web-mediadevices-player",target:"_blank"},"🔗Github")],-1),ve=["controls"];function he(e,o,r,n,v,h){return m(),g("div",ee,[a("div",{class:B(["loading-layer",{visible:e.isLoading}])},"Loading...",2),a("div",te,[a("div",{ref:"actionBarRef",class:B(["action-bar font-emoji",{visible:!e.currentVideoDeviceId&&!e.currentAudioDeviceId}])},[a("div",oe,[a("label",se,[ie,b(a("select",{title:"Video",id:"videoSelect","onUpdate:modelValue":o[0]||(o[0]=t=>e.currentVideoDeviceId=t)},[(m(!0),g(M,null,H(e.videoDeviceList,t=>(m(),g("option",{key:t.deviceId,value:t.deviceId},j(t.label),9,ae))),128))],512),[[U,e.currentVideoDeviceId]])]),a("label",ne,[re,b(a("select",{name:"Audio",id:"audioSelect","onUpdate:modelValue":o[1]||(o[1]=t=>e.currentAudioDeviceId=t)},[(m(!0),g(M,null,H(e.audioDeviceList,t=>(m(),g("option",{key:t.deviceId,value:t.deviceId},j(t.label),9,le))),128))],512),[[U,e.currentAudioDeviceId]])]),a("button",{onClick:o[2]||(o[2]=(...t)=>e.handleStart&&e.handleStart(...t))},"▶Start"),a("button",{onClick:o[3]||(o[3]=(...t)=>e.stopBothVideoAndAudio&&e.stopBothVideoAndAudio(...t))},"⏹Stop"),a("button",{onClick:o[4]||(o[4]=(...t)=>e.clearSelect&&e.clearSelect(...t))},"🛑Reset"),a("button",{onClick:o[5]||(o[5]=(...t)=>e.toggleFullScreen&&e.toggleFullScreen(...t))},"📺Fullscreen"),a("label",de,[b(a("input",{id:"toggleControls",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=t=>e.isShowControls=t),title:"Show Controls"},null,512),[[N,e.isShowControls]]),ce]),a("button",{onClick:o[7]||(o[7]=(...t)=>e.handleStartCaptureScreen&&e.handleStartCaptureScreen(...t))},"⏺Capture..."),a("button",{onClick:o[8]||(o[8]=(...t)=>e.handleScreenshot&&e.handleScreenshot(...t))},"📷Screenshot")]),ue],2)]),a("video",{ref:"videoRef",id:"videoId",autoplay:"",playsinline:"",controls:e.isShowControls},null,8,ve)],512)}const we=W(x,[["render",he]]);export{we as default};
