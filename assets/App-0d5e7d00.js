import{aI as j,d as P,r as b,bh as g,c as V,o as N,j as z,aE as m,aF as p,aG as i,aK as R,ai as D,cn as B,$ as U,aJ as $,co as J,aL as H,aR as K,aN as Q}from"./index-362206a9.js";import{b as X,a as T,c as Y}from"./use-local-storage-c1736753.js";function Z(e){let o=document.createElement("canvas");o.width=e.videoWidth,o.height=e.videoHeight,o.getContext("2d").drawImage(e,0,0,e.videoWidth,e.videoHeight);const r=o.toDataURL("image/png"),n=document.createElement("a");n.download="video-screenshot.png",n.href=r,n.click()}class x{constructor(o,r,n=1e3){this.timeoutID=null,this.targetEl=document.querySelector(o),this.showHideFn=r,this.time=n,this.showCursor=this.showCursor.bind(this),this.start()}hideCursor(){typeof this.showHideFn=="function"?this.showHideFn({el:this.targetEl,isShow:!1}):this.targetEl.style.cursor="none"}showCursor(){typeof this.showHideFn=="function"?this.showHideFn({el:this.targetEl,isShow:!0}):this.targetEl.style.cursor="",this.runTimer()}runTimer(){clearTimeout(this.timeoutID),this.timeoutID=setTimeout(()=>{this.hideCursor()},this.time)}start(){document.addEventListener("mousemove",this.showCursor),this.runTimer()}stop(){document.removeEventListener("mousemove",this.showCursor),clearTimeout(this.timeoutID)}}async function ee(){var e;if((e=navigator.mediaDevices)!=null&&e.enumerateDevices)return await navigator.mediaDevices.enumerateDevices();throw new Error("enumerateDevices() not supported.")}const te=P({setup(){const e=b(!1),o=X("ls_key_is_show_controls",!1),r=b([]),n=b(),u=T("ls_key_video_device_id",""),v=T("ls_key_audio_device_id",""),t=Y("ls_key_video_config"),f=g(),I=(s,a)=>s.filter(l=>l.kind===a&&!!l.deviceId),_=V(()=>I(r.value,"videoinput")),W=V(()=>I(r.value,"audioinput")),w=async()=>{try{e.value=!0,r.value=await ee()}catch(s){console.error(s),alert("Error: "+s.message)}finally{e.value=!1}},E=()=>{navigator.mediaDevices.ondevicechange=async()=>{await w()}},S=g(),k=g(),L=g();N(async()=>{S.value=new x("#app",({el:s,isShow:a})=>{const l=k.value;a?(s.style.cursor="",l.classList.add("visible")):(s.style.cursor="none",l.classList.remove("visible"))},3e3);try{if(u.value||v.value){await F(),await w(),E();return}try{f.value=await navigator.mediaDevices.getUserMedia({audio:!0}),d()}catch(s){console.warn("getUserMedia audio Error:",s)}try{f.value=await navigator.mediaDevices.getUserMedia({video:!0}),d()}catch(s){console.warn("getUserMedia video Error:",s)}await w(),E()}catch(s){console.error(s),alert("Error: "+s.message)}}),z(()=>{S.value&&S.value.stop(),d()});const F=async()=>{try{e.value=!0;const a=u.value,l=v.value;let c=!1;if(a)if(!t.value||t.value.deviceId!==a){const C=_.value.find(h=>h.deviceId===a);if(console.log(C),C){const h=C.getCapabilities();c=t.value={deviceId:h.deviceId,height:h.height.max,width:h.width.max,frameRate:h.frameRate.max}}else c={deviceId:a}}else c=t.value;var s={audio:l?{deviceId:l,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1}:!1,video:c};const M=await navigator.mediaDevices.getUserMedia(s);f.value=M;const y=n.value;y.srcObject=M,y.onloadedmetadata=()=>{y.play()}}catch(a){console.error(a),alert("Error: "+a.message)}finally{e.value=!1}},O=()=>{d(),F()},d=()=>{const s=n.value;s.pause(),s.srcObject=null;const a=f.value;if(!a)return;a.getTracks().forEach(c=>{c.readyState=="live"&&c.stop()})},G=()=>{d(),u.value="",v.value="",t.value=null};function A(s=!1){const a=L.value.closest(".vp-window");a&&(s?a.classList.add("_fullscreen_content"):a.classList.remove("_fullscreen_content"))}function q(){document.fullscreenElement?document.exitFullscreen&&(document.exitFullscreen(),A(!1)):(document.documentElement.requestFullscreen(),A(!0))}return{videoRef:n,deviceList:r,currentVideoDeviceId:u,videoDeviceList:_,currentAudioDeviceId:v,audioDeviceList:W,handleStart:O,stopBothVideoAndAudio:d,clearSelect:G,isLoading:e,isShowControls:o,toggleFullScreen:q,handleStartCaptureScreen:async()=>{try{e.value=!0,d();const s=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"window"},audio:!0});f.value=s;const a=n.value;a.srcObject=s,a.onloadedmetadata=()=>{a.play()}}catch(s){console.error(s),alert("Error: "+s.message)}finally{e.value=!1}},handleScreenshot:()=>{Z(n.value)},actionBarRef:k,rootRef:L}}}),oe={ref:"rootRef",class:"web-mediadevices-player"},se={class:"action-bar-wrap"},ae={class:"action-bar-side"},ie={for:"videoSelect"},ne=i("span",null,"Video:",-1),re=["value"],le={for:"audioSelect"},de=i("span",null,"Audio:",-1),ce=["value"],ue={for:"toggleControls"},ve=i("span",null,"Controls",-1),he=i("div",null,[i("a",{href:"https://github.com/canwdev/web-mediadevices-player",target:"_blank"},"🔗Github")],-1),me=["controls"];function fe(e,o,r,n,u,v){return m(),p("div",oe,[i("div",{class:R(["loading-layer",{visible:e.isLoading}])},"Loading...",2),i("div",se,[i("div",{ref:"actionBarRef",class:R(["action-bar font-emoji",{visible:!e.currentVideoDeviceId&&!e.currentAudioDeviceId}])},[i("div",ae,[i("label",ie,[ne,D(i("select",{title:"Video",id:"videoSelect","onUpdate:modelValue":o[0]||(o[0]=t=>e.currentVideoDeviceId=t)},[(m(!0),p(U,null,$(e.videoDeviceList,t=>(m(),p("option",{key:t.deviceId,value:t.deviceId},H(t.label),9,re))),128))],512),[[B,e.currentVideoDeviceId]])]),i("label",le,[de,D(i("select",{name:"Audio",id:"audioSelect","onUpdate:modelValue":o[1]||(o[1]=t=>e.currentAudioDeviceId=t)},[(m(!0),p(U,null,$(e.audioDeviceList,t=>(m(),p("option",{key:t.deviceId,value:t.deviceId},H(t.label),9,ce))),128))],512),[[B,e.currentAudioDeviceId]])]),i("button",{onClick:o[2]||(o[2]=(...t)=>e.handleStart&&e.handleStart(...t))},"▶Start"),i("button",{onClick:o[3]||(o[3]=(...t)=>e.stopBothVideoAndAudio&&e.stopBothVideoAndAudio(...t))},"⏹Stop"),i("button",{onClick:o[4]||(o[4]=(...t)=>e.clearSelect&&e.clearSelect(...t))},"🛑Reset"),i("button",{onClick:o[5]||(o[5]=(...t)=>e.toggleFullScreen&&e.toggleFullScreen(...t))},"📺Fullscreen"),i("label",ue,[D(i("input",{id:"toggleControls",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=t=>e.isShowControls=t),title:"Show Controls"},null,512),[[J,e.isShowControls]]),ve]),i("button",{onClick:o[7]||(o[7]=(...t)=>e.handleStartCaptureScreen&&e.handleStartCaptureScreen(...t))},"⏺Capture..."),i("button",{onClick:o[8]||(o[8]=(...t)=>e.handleScreenshot&&e.handleScreenshot(...t))},"📷Screenshot")]),he],2)]),i("video",{ref:"videoRef",id:"videoId",autoplay:"",playsinline:"",controls:e.isShowControls},null,8,me)],512)}const pe=j(te,[["render",fe]]),ge=P({name:"MediadevicesPlayer",components:{WebMediadevicesPlayer:pe}});function we(e,o,r,n,u,v){const t=K("WebMediadevicesPlayer");return m(),Q(t)}const De=j(ge,[["render",we]]);export{De as default};
