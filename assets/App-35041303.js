import{aI as G,d as q,r as C,bh as D,c as F,o as W,j as z,aE as f,aF as p,aG as i,aK as V,aj as b,cj as B,$ as U,aJ as M,ck as J,aL as R}from"./index-49ca2576.js";import{b as K,a as H,c as N}from"./use-local-storage-6b36f708.js";function P(e){let o=document.createElement("canvas");o.width=e.videoWidth,o.height=e.videoHeight,o.getContext("2d").drawImage(e,0,0,e.videoWidth,e.videoHeight);const r=o.toDataURL("image/png"),n=document.createElement("a");n.download="video-screenshot.png",n.href=r,n.click()}class Q{constructor(o,r,n=1e3){this.timeoutID=null,this.targetEl=document.querySelector(o),this.showHideFn=r,this.time=n,this.showCursor=this.showCursor.bind(this),this.start()}hideCursor(){typeof this.showHideFn=="function"?this.showHideFn({el:this.targetEl,isShow:!1}):this.targetEl.style.cursor="none"}showCursor(){typeof this.showHideFn=="function"?this.showHideFn({el:this.targetEl,isShow:!0}):this.targetEl.style.cursor="",this.runTimer()}runTimer(){clearTimeout(this.timeoutID),this.timeoutID=setTimeout(()=>{this.hideCursor()},this.time)}start(){document.addEventListener("mousemove",this.showCursor),this.runTimer()}stop(){document.removeEventListener("mousemove",this.showCursor),clearTimeout(this.timeoutID)}}async function X(){var e;if((e=navigator.mediaDevices)!=null&&e.enumerateDevices)return await navigator.mediaDevices.enumerateDevices();throw new Error("enumerateDevices() not supported.")}const Y=q({setup(){const e=C(!1),o=K("ls_key_is_show_controls",!1),r=C([]),n=C(),v=H("ls_key_video_device_id",""),h=H("ls_key_audio_device_id",""),t=N("ls_key_video_config"),m=D(),I=(s,a)=>s.filter(l=>l.kind===a&&!!l.deviceId),k=F(()=>I(r.value,"videoinput")),j=F(()=>I(r.value,"audioinput")),g=async()=>{try{e.value=!0,r.value=await X()}catch(s){console.error(s),alert("Error: "+s.message)}finally{e.value=!1}},E=()=>{navigator.mediaDevices.ondevicechange=async()=>{await g()}},w=D(),L=D();W(async()=>{w.value=new Q("#app",({el:s,isShow:a})=>{const l=L.value;a?(s.style.cursor="",l.classList.add("visible")):(s.style.cursor="none",l.classList.remove("visible"))},3e3);try{if(v.value||h.value){await _(),await g(),E();return}try{m.value=await navigator.mediaDevices.getUserMedia({audio:!0}),d()}catch(s){console.warn("getUserMedia audio Error:",s)}try{m.value=await navigator.mediaDevices.getUserMedia({video:!0}),d()}catch(s){console.warn("getUserMedia video Error:",s)}await g(),E()}catch(s){console.error(s),alert("Error: "+s.message)}}),z(()=>{w.value&&w.value.stop(),d()});const _=async()=>{try{e.value=!0;const a=v.value,l=h.value;let c=!1;if(a)if(!t.value||t.value.deviceId!==a){const y=k.value.find(u=>u.deviceId===a);if(console.log(y),y){const u=y.getCapabilities();c=t.value={deviceId:u.deviceId,height:u.height.max,width:u.width.max,frameRate:u.frameRate.max}}else c={deviceId:a}}else c=t.value;var s={audio:l?{deviceId:l,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1}:!1,video:c};const A=await navigator.mediaDevices.getUserMedia(s);m.value=A;const S=n.value;S.srcObject=A,S.onloadedmetadata=()=>{S.play()}}catch(a){console.error(a),alert("Error: "+a.message)}finally{e.value=!1}},T=()=>{d(),_()},d=()=>{const s=n.value;s.pause(),s.srcObject=null;const a=m.value;if(!a)return;a.getTracks().forEach(c=>{c.readyState=="live"&&c.stop()})},$=()=>{d(),v.value="",h.value="",t.value=null};function O(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}return{videoRef:n,deviceList:r,currentVideoDeviceId:v,videoDeviceList:k,currentAudioDeviceId:h,audioDeviceList:j,handleStart:T,stopBothVideoAndAudio:d,clearSelect:$,isLoading:e,isShowControls:o,toggleFullScreen:O,handleStartCaptureScreen:async()=>{try{e.value=!0,d();const s=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"window"},audio:!0});m.value=s;const a=n.value;a.srcObject=s,a.onloadedmetadata=()=>{a.play()}}catch(s){console.error(s),alert("Error: "+s.message)}finally{e.value=!1}},handleScreenshot:()=>{P(n.value)},actionBarRef:L}}}),Z={class:"web-mediadevices-player"},x={class:"action-bar-wrap"},ee={class:"action-bar-side"},te={for:"videoSelect"},oe=i("span",null,"Video:",-1),se=["value"],ie={for:"audioSelect"},ae=i("span",null,"Audio:",-1),ne=["value"],re={for:"toggleControls"},le=i("span",null,"Controls",-1),de=i("div",null,[i("a",{href:"https://github.com/canwdev/web-mediadevices-player",target:"_blank"},"🔗Github")],-1),ce=["controls"];function ue(e,o,r,n,v,h){return f(),p("div",Z,[i("div",{class:V(["loading-layer",{visible:e.isLoading}])},"Loading...",2),i("div",x,[i("div",{ref:"actionBarRef",class:V(["action-bar font-emoji",{visible:!e.currentVideoDeviceId&&!e.currentAudioDeviceId}])},[i("div",ee,[i("label",te,[oe,b(i("select",{title:"Video",id:"videoSelect","onUpdate:modelValue":o[0]||(o[0]=t=>e.currentVideoDeviceId=t)},[(f(!0),p(U,null,M(e.videoDeviceList,t=>(f(),p("option",{key:t.deviceId,value:t.deviceId},R(t.label),9,se))),128))],512),[[B,e.currentVideoDeviceId]])]),i("label",ie,[ae,b(i("select",{name:"Audio",id:"audioSelect","onUpdate:modelValue":o[1]||(o[1]=t=>e.currentAudioDeviceId=t)},[(f(!0),p(U,null,M(e.audioDeviceList,t=>(f(),p("option",{key:t.deviceId,value:t.deviceId},R(t.label),9,ne))),128))],512),[[B,e.currentAudioDeviceId]])]),i("button",{onClick:o[2]||(o[2]=(...t)=>e.handleStart&&e.handleStart(...t))},"▶Start"),i("button",{onClick:o[3]||(o[3]=(...t)=>e.stopBothVideoAndAudio&&e.stopBothVideoAndAudio(...t))},"⏹Stop"),i("button",{onClick:o[4]||(o[4]=(...t)=>e.clearSelect&&e.clearSelect(...t))},"🛑Reset"),i("button",{onClick:o[5]||(o[5]=(...t)=>e.toggleFullScreen&&e.toggleFullScreen(...t))},"📺Fullscreen"),i("label",re,[b(i("input",{id:"toggleControls",type:"checkbox","onUpdate:modelValue":o[6]||(o[6]=t=>e.isShowControls=t),title:"Show Controls"},null,512),[[J,e.isShowControls]]),le]),i("button",{onClick:o[7]||(o[7]=(...t)=>e.handleStartCaptureScreen&&e.handleStartCaptureScreen(...t))},"⏺Capture..."),i("button",{onClick:o[8]||(o[8]=(...t)=>e.handleScreenshot&&e.handleScreenshot(...t))},"📷Screenshot")]),de],2)]),i("video",{ref:"videoRef",id:"videoId",autoplay:"",playsinline:"",controls:e.isShowControls},null,8,ce)])}const pe=G(Y,[["render",ue]]);export{pe as default};
