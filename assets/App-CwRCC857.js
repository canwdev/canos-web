import{_ as e,d as t,r as i,by as a,bE as o,D as s,M as r,l,c7 as n,o as d,c,b as u,n as v,w as h,c6 as m,F as g,e as p,t as w,f,c8 as y}from"./index-CKZunzLP.js";class S{constructor(e,t,i=1e3){this.timeoutID=null,this.targetEl=document.querySelector(e),this.showHideFn=t,this.time=i,this.showCursor=this.showCursor.bind(this),this.start()}hideCursor(){"function"==typeof this.showHideFn?this.showHideFn({el:this.targetEl,isShow:!1}):this.targetEl.style.cursor="none"}showCursor(){"function"==typeof this.showHideFn?this.showHideFn({el:this.targetEl,isShow:!0}):this.targetEl.style.cursor="",this.runTimer()}runTimer(){clearTimeout(this.timeoutID),this.timeoutID=setTimeout((()=>{this.hideCursor()}),this.time)}start(){document.addEventListener("mousemove",this.showCursor),this.runTimer()}stop(){document.removeEventListener("mousemove",this.showCursor),clearTimeout(this.timeoutID)}}const b=t({setup(){const e=i(!1),t=i(!!window.__TAURI__),d=a("ls_key_is_show_controls",!1),c=i([]),u=i(),v=a("ls_key_video_device_id",""),h=a("ls_key_audio_device_id",""),m=a("ls_key_video_config",{}),g=o(),p=(e,t)=>e.filter((e=>e.kind===t&&!!e.deviceId)),w=s((()=>p(c.value,"videoinput"))),f=s((()=>p(c.value,"audioinput"))),y=async()=>{try{e.value=!0,c.value=await async function(){var e;if(null==(e=navigator.mediaDevices)?void 0:e.enumerateDevices)return await navigator.mediaDevices.enumerateDevices();throw new Error("enumerateDevices() not supported.")}()}catch(t){console.error(t),alert("Error: "+t.message)}finally{e.value=!1}},b=()=>{navigator.mediaDevices.ondevicechange=async()=>{await y()}},C=o(),D=o(),I=o();r((async()=>{C.value=new S("#app",(({el:e,isShow:t})=>{const i=D.value;t?(e.style.cursor="",i.classList.add("visible")):(e.style.cursor="none",i.classList.remove("visible"))}),3e3);try{if(v.value||h.value)return await _(),await y(),void b();try{g.value=await navigator.mediaDevices.getUserMedia({audio:!0}),k()}catch(e){console.warn("getUserMedia audio Error:",e)}try{g.value=await navigator.mediaDevices.getUserMedia({video:!0}),k()}catch(e){console.warn("getUserMedia video Error:",e)}await y(),b()}catch(e){console.error(e),alert("Error: "+e.message)}})),l((()=>{C.value&&C.value.stop(),k()}));const _=async()=>{try{e.value=!0;const i=v.value,a=h.value;let o=!1;if(i)if(m.value&&m.value.deviceId===i)o=m.value;else{const e=w.value.find((e=>e.deviceId===i));if(console.log(e),e){const t=e.getCapabilities();o=m.value={deviceId:t.deviceId,height:t.height.max,width:t.width.max,frameRate:t.frameRate.max}}else o={deviceId:i}}var t={audio:!!a&&{deviceId:a,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1},video:o};const s=await navigator.mediaDevices.getUserMedia(t);g.value=s;const r=u.value;r.srcObject=s,r.onloadedmetadata=()=>{r.play()}}catch(i){console.error(i),alert("Error: "+i.message)}finally{e.value=!1}},k=()=>{const e=u.value;e.pause(),e.srcObject=null;const t=g.value;if(!t)return;t.getTracks().forEach((e=>{"live"==e.readyState&&e.stop()}))},{toggle:E}=n(I);return{videoRef:u,deviceList:c,currentVideoDeviceId:v,videoDeviceList:w,currentAudioDeviceId:h,audioDeviceList:f,handleStart:()=>{k(),_()},stopBothVideoAndAudio:k,clearSelect:()=>{k(),v.value="",h.value="",m.value=null},isLoading:e,isShowControls:d,toggleFullScreen:E,handleStartCaptureScreen:async()=>{try{e.value=!0,k();const t=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"window"},audio:!0});g.value=t;const i=u.value;i.srcObject=t,i.onloadedmetadata=()=>{i.play()}}catch(t){console.error(t),alert("Error: "+t.message)}finally{e.value=!1}},handleScreenshot:()=>{!function(e){let t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,e.videoWidth,e.videoHeight);const i=t.toDataURL("image/png"),a=document.createElement("a");a.download="video-screenshot.png",a.href=i,a.click()}(u.value)},actionBarRef:D,rootRef:I,isTauri:t}}}),C={ref:"rootRef",class:"web-mediadevices-player"},D={class:"action-bar-wrap"},I={class:"action-bar-side"},_={for:"videoSelect"},k=u("span",null,"Video:",-1),E=["value"],A={for:"audioSelect"},L=u("span",null,"Audio:",-1),V=["value"],R={for:"toggleControls"},F=u("span",null,"Controls",-1),T=u("div",{class:"action-bar-side right"},[u("a",{href:"https://github.com/canwdev/web-mediadevices-player",target:"_blank"},"🔗Github")],-1),U=["controls"];const x=e(b,[["render",function(e,t,i,a,o,s){return d(),c("div",C,[u("div",{class:v(["loading-layer",{visible:e.isLoading}])},"Loading...",2),u("div",D,[u("div",{ref:"actionBarRef",class:v(["action-bar font-emoji",{visible:!e.currentVideoDeviceId&&!e.currentAudioDeviceId}])},[u("div",I,[u("label",_,[k,h(u("select",{title:"Video",id:"videoSelect","onUpdate:modelValue":t[0]||(t[0]=t=>e.currentVideoDeviceId=t)},[(d(!0),c(g,null,p(e.videoDeviceList,(e=>(d(),c("option",{key:e.deviceId,value:e.deviceId},w(e.label),9,E)))),128))],512),[[m,e.currentVideoDeviceId]])]),u("label",A,[L,h(u("select",{name:"Audio",id:"audioSelect","onUpdate:modelValue":t[1]||(t[1]=t=>e.currentAudioDeviceId=t)},[(d(!0),c(g,null,p(e.audioDeviceList,(e=>(d(),c("option",{key:e.deviceId,value:e.deviceId},w(e.label),9,V)))),128))],512),[[m,e.currentAudioDeviceId]])]),u("button",{onClick:t[2]||(t[2]=(...t)=>e.handleStart&&e.handleStart(...t))},"▶Start"),u("button",{onClick:t[3]||(t[3]=(...t)=>e.stopBothVideoAndAudio&&e.stopBothVideoAndAudio(...t))},"⏹Stop"),u("button",{onClick:t[4]||(t[4]=(...t)=>e.clearSelect&&e.clearSelect(...t))},"🛑Reset"),e.isTauri?f("",!0):(d(),c("button",{key:0,onClick:t[5]||(t[5]=(...t)=>e.toggleFullScreen&&e.toggleFullScreen(...t))},"📺Fullscreen")),u("label",R,[h(u("input",{id:"toggleControls",type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=t=>e.isShowControls=t),title:"Show Controls"},null,512),[[y,e.isShowControls]]),F]),u("button",{onClick:t[7]||(t[7]=(...t)=>e.handleStartCaptureScreen&&e.handleStartCaptureScreen(...t))},"⏺Capture..."),u("button",{onClick:t[8]||(t[8]=(...t)=>e.handleScreenshot&&e.handleScreenshot(...t))},"📷Screenshot")]),T],2)]),u("video",{ref:"videoRef",id:"videoId",autoplay:"",playsinline:"",controls:e.isShowControls},null,8,U)],512)}]]);export{x as default};
