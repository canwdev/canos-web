import{d as e,r as s,y as a,q as t,D as o,a as l,w as r,O as n,P as i,c as u,e as p,f as d,Q as m,z as c,A as b,l as v,R as y,b as f,m as g,v as w,F as _,S as k,T as h,U as I,p as S,o as x,_ as T}from"./index-CQGI0j3m.js";import{_ as q,A as E}from"./index.vue_vue_type_style_index_0_lang-DgNtZuG4.js";/* empty css                  *//* empty css                 *//* empty css                        */import"./index-Bc-2Q8zN.js";const L=e({__name:"LoginForm",props:{showSubmit:{type:Boolean},disabled:{type:Boolean}},emits:["submit"],setup(e,{expose:r,emit:n}){const i=s(),u=s({username:"",password:""}),p={username:[{required:!0,message:"Username is required",trigger:["blur"]}],password:[{required:!0,message:"Password is required",trigger:["blur"]}]},d=()=>{i.value.submitForm()},m=a((()=>[{type:E.INPUT,key:"username",label:"Username",placeholder:" ",props:{onKeyup:e=>{"Enter"===e.key&&d()}}},{type:E.INPUT,key:"password",label:"Password",placeholder:" ",props:{type:"password",showPassword:!0,onKeyup:e=>{"Enter"===e.key&&d()}}}]));return r({submitForm:d}),(e,s)=>(t(),o(q,{ref_key:"formRef",ref:i,"form-schema":{model:l(u),rules:p,props:{labelPosition:"top"},formItems:m.value},"hide-actions":"",onOnSubmit:s[0]||(s[0]=s=>e.$emit("submit",l(u)))},null,8,["form-schema"]))}}),F=e=>(S("data-v-f86510a7"),e=e(),x(),e),P={class:"login-view"},U={class:"login-box-wrapper vp-panel"},j=F((()=>f("div",{class:"l-title"},"Login",-1))),K={key:0,class:"flex-row-center-gap font-code"},O=F((()=>f("div",null,"请输入接口传输密钥(ck):",-1))),R=["disabled"],C={class:"login-actions"},N=[F((()=>f("span",{class:"mdi mdi-ip-network"},null,-1)))],A=[F((()=>f("span",{class:"mdi mdi-security-network"},null,-1)))],$=["disabled"],z=T(e({__name:"Login",setup(e){const a=c(),o=b(),S=s("");r(y,(e=>{S.value=e}),{immediate:!0});const x=s(!1),T=s(!1),q=async e=>{if(!T.value)try{T.value=!0;let{username:s,password:t}=e;const l=await k.userLogin(s,t);console.log("[userLogin] res",l);const{authorizationToken:r,refreshToken:n}=l;if(!r||!n)return void window.$message.error("Invalid backend token!");localStorage.setItem(h.LS_KEY_AUTHORIZATION_TOKEN,r),localStorage.setItem(h.LS_KEY_REFRESH_TOKEN,n),a.query.redirect?await o.push({path:a.query.redirect}):await o.push({path:"/"})}catch(s){console.error(s)}finally{T.value=!1}},E=()=>{z.value.submitForm()},F=s(),z=s();return n((()=>{i((()=>{var e;null==(e=F.value)||e.focus()}))})),(e,s)=>{const a=I;return t(),u("div",P,[p(m,null,{default:d((()=>[v((t(),u("div",U,[j,!l(y)||l(x)?(t(),u("div",K,[O,v(f("input",{type:"text",class:"vp-input","onUpdate:modelValue":s[0]||(s[0]=e=>g(S)?S.value=e:null),style:{width:"100%"},placeholder:"请输入接口密钥"},null,512),[[w,l(S)]]),f("button",{class:"vp-button primary",onClick:s[1]||(s[1]=e=>(y.value=S.value,void(x.value=!1))),disabled:!l(S),style:{"margin-left":"auto"}}," Submit ",8,R)])):(t(),u(_,{key:1},[p(L,{ref_key:"loginFormRef",ref:z,onSubmit:q,disabled:l(T)},null,8,["disabled"]),f("div",C,[f("button",{class:"vp-button",type:"button",onClick:s[2]||(s[2]=s=>e.$router.push({name:"IpChooserView"}))},N),f("button",{class:"vp-button",type:"button",onClick:s[3]||(s[3]=e=>x.value=!0)},A),f("button",{class:"vp-button btn-login",type:"button",onClick:E,disabled:l(T)}," Login ",8,$)])],64))])),[[a,l(T)]])])),_:1})])}}}),[["__scopeId","data-v-f86510a7"]]);export{z as default};
