import{ag as e,r as a,w as l,N as t,C as r,d as s,q as n,c as o,e as i,f as u,F as d,j as p,D as c,b1 as m,k as g,ab as v,al as y,a as h,m as b,J as f,b2 as C,b3 as w,a5 as k,b4 as P,z,A as S,_,b5 as U,b6 as I,y as D,O as x,l as E,b as N,h as R,ad as q,U as A,g as j,$ as F,aN as O,ai as L,b7 as T,S as $}from"./index-CQGI0j3m.js";import{_ as M,A as V}from"./index.vue_vue_type_style_index_0_lang-DgNtZuG4.js";import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                 *//* empty css                        */import"./index-Bc-2Q8zN.js";const K=(e,a)=>{e.forEach((e=>{"children"in e&&Array.isArray(e.children)?K(e.children,a):Array.isArray(e)?K(e,a):a(e)}))},B=s=>{const{columns:n}=e(s),o=a(!1),i=a([]);l(o,(e=>{e?i.value=(()=>{if(!n.value||!n.value.length)return[];const e=[];return n.value.forEach((a=>{a.label&&!a.isCustomizeColumn&&a.label&&e.push({label:a.label,value:a.key||a.label})})),e})():(i.value=[],d.value=p())}));const u=t(s.customizeColumnStorageKey,{}),d=a([]),p=()=>n.value?u.value&&Object.values(u.value).length?n.value.filter((e=>{if(!e.label)return!0;const a=e.key||e.label;return!u.value[a]})):n.value:[];return r((()=>{d.value=p()})),{isShowColumnEdit:o,hiddenColumnKeyMap:u,columnsOptions:i,filteredColumns:d,handleUpdateCheck:e=>{u.value[e]?delete u.value[e]:u.value[e]=1}}},W=["innerHTML"],H=s({__name:"index",props:{columns:{},data:{},customizeColumnStorageKey:{default:"ate_hidden_column_keys"}},emits:["selectionChange"],setup(e,{expose:l,emit:t}){const r=e,{isShowColumnEdit:s,hiddenColumnKeyMap:z,tableColumnsOptions:S,filteredColumns:_,handleUpdateCheck:U}=B(r),I=a();return l({tableRef:I}),(e,a)=>{const l=f,t=C,r=w,D=k,x=P;return n(),o(d,null,[i(r,y({ref_key:"tableRef",ref:I,data:e.data,class:"auto-table-el-plus"},e.$attrs,{onSelectionChange:a[1]||(a[1]=a=>e.$emit("selectionChange",a))}),{default:u((()=>[(n(!0),o(d,null,p(h(_),(e=>(n(),c(t,y({key:e.key,property:e.key,label:e.label,width:e.width,"min-width":e.minWidth},e.props,{type:e.type,fixed:e.fixed}),m({_:2},[e.headerRender||e.isCustomizeColumn?{name:"header",fn:u((()=>[e.isCustomizeColumn?(n(),c(l,{key:0,onClick:a[0]||(a[0]=e=>s.value=!0),icon:"ElIconOperation",size:"small",text:""})):g("",!0),e.headerRender?(n(),c(v,{key:1,"render-fn":e.headerRender},null,8,["render-fn"])):g("",!0)])),key:"0"}:void 0,e.formatter||e.render?{name:"default",fn:u((a=>[e.formatter?(n(),o("span",{key:0,innerHTML:e.formatter(a)},null,8,W)):g("",!0),e.render?(n(),c(v,{key:1,"render-fn":e.render,params:a},null,8,["render-fn","params"])):g("",!0)])),key:"1"}:void 0]),1040,["property","label","width","min-width","type","fixed"])))),128))])),_:1},16,["data"]),i(x,{modelValue:h(s),"onUpdate:modelValue":a[2]||(a[2]=e=>b(s)?s.value=e:null),title:"自定义表列",width:"500px",top:"5vh"},{default:u((()=>[(n(!0),o(d,null,p(h(S),(e=>(n(),c(D,{key:e.value,label:e.label,value:e.value,"model-value":!h(z)[e.value],"onUpdate:modelValue":a=>h(U)(e.value)},null,8,["label","value","model-value","onUpdate:modelValue"])))),128))])),_:1},8,["modelValue"])],64)}}}),J=s({name:"ListPagination",props:{paginationData:{type:Object,required:!0},hideOnSinglePage:{type:Boolean,default:!1},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},updateRouter:{type:Boolean,default:!0},pageSizes:{type:Array,default:null}},emits:["sizeChange","currentChange","pageInitReady"],setup(a,{emit:l}){const{paginationData:t,updateRouter:s}=e(a),n=z(),o=S();return r((()=>{if(s.value){let e=Number(n.query.pageSize),a=Number(n.query.pageNum);Number.isNaN(e)||(t.value.pageSize=e),Number.isNaN(a)||(a<0&&(a=1),t.value.currentPage=a)}l("pageInitReady")})),{handlePageSizeChange:e=>{if(s.value){const a=n.query;parseInt(a.pageNum)===Math.ceil(t.value.totalItems/a.pageSize)&&(t.value.currentPage=Math.ceil(t.value.totalItems/e)),o.replace({query:{...a,pageSize:e,pageNum:t.value.currentPage}})}l("sizeChange",e)},handlePageCurrentChange:e=>{if(e<0&&(e=1),s.value){const a=n.query;o.replace({query:{...a,pageNum:e}})}l("currentChange",e)}}}}),G={class:"common-pagination-wrap"};const Q=_(J,[["render",function(e,a,l,t,r,s){const u=U;return n(),o("div",G,[i(u,{"current-page":e.paginationData.currentPage,"onUpdate:currentPage":a[0]||(a[0]=a=>e.paginationData.currentPage=a),"page-size":e.paginationData.pageSize,"onUpdate:pageSize":a[1]||(a[1]=a=>e.paginationData.pageSize=a),"hide-on-single-page":e.hideOnSinglePage,total:e.paginationData.totalItems,"page-sizes":e.pageSizes||[5,10,20,50,100,200,500],layout:e.layout,onSizeChange:e.handlePageSizeChange,onCurrentChange:e.handlePageCurrentChange},null,8,["current-page","page-size","hide-on-single-page","total","page-sizes","layout","onSizeChange","onCurrentChange"])])}]]),X={class:"auto-list-wrap"},Y={class:"common-title-row"},Z=["title"],ee={class:"common-actions"},ae={key:0,class:"vp-panel filter-card"},le={class:"table-wrap"},te=_(s({__name:"AutoFilterList",props:{title:{},titleDesc:{},filterFormItems:{},tableColumns:{},requestDataFn:{},enablePagination:{type:Boolean,default:!1}},setup(l,{expose:t}){const s=l,d=z(),p=D((()=>d.meta.title)),{requestDataFn:m,filterFormItems:v,enablePagination:y}=e(s),b=a(!1),C=a([]),{paginationData:w}=((e={})=>{const a=I({totalItems:e.totalItems||0,pageSize:e.pageSize||10,currentPage:e.currentPage||1,totalPages:e.totalPages||0}),l=D((()=>a.totalItems<a.totalPages*a.pageSize)),t=D((()=>a.totalItems<=a.currentPage*a.pageSize));return{paginationData:a,isSinglePage:l,isReachedEnd:t}})(),k=a({}),P=D((()=>v.value?{model:k.value,props:{labelPlacement:"left",size:"small"},formItems:v.value}:null));async function S({isResetPage:e=!1}={}){try{b.value=!0,y.value&&e&&(w.currentPage=1);let a={};y.value&&(a={page:w.currentPage,limit:w.pageSize}),a={...a,...k.value},console.log(a);const l=await m.value(a);if(!l)throw Error("res is not exist");y.value?(C.value=l.results,w.totalItems=l.total):C.value=l}catch(a){console.error(a)}finally{b.value=!1}}return r((()=>{v.value&&(e=>{const a=[];return K(e,(e=>{a.push(e)})),a})(v.value).forEach((e=>{k.value[e.key]=void 0}))})),x((()=>{S()})),t({loadData:S,isLoading:b}),(e,a)=>{const l=f,t=A;return E((n(),o("div",X,[N("div",Y,[N("div",{class:"common-title text-overflow",title:e.titleDesc},R(e.title||p.value),9,Z),N("div",ee,[q(e.$slots,"actions",{},(()=>[i(l,{onClick:S},{default:u((()=>[j(" Refresh ")])),_:1})]),!0),q(e.$slots,"actionsMore",{},void 0,!0)])]),P.value?(n(),o("div",ae,[i(M,{"form-schema":P.value,onOnSubmit:a[0]||(a[0]=e=>S({isResetPage:!0}))},null,8,["form-schema"])])):g("",!0),N("div",le,[i(H,{stripe:"",border:"",height:"100%",data:h(C),columns:e.tableColumns},null,8,["data","columns"])]),h(y)?(n(),c(Q,{key:1,"pagination-data":h(w),onSizeChange:a[1]||(a[1]=e=>S()),onCurrentChange:a[2]||(a[2]=e=>S())},null,8,["pagination-data"])):g("",!0)])),[[t,h(b)]])}}}),[["__scopeId","data-v-6cca29db"]]);var re=(e=>(e.admin="admin",e.user="user",e))(re||{});const se=Object.entries(re).map((([e,a])=>({label:e,value:a}))),ne=[{label:"Disabled",value:!0},{label:"Enable",value:!1}],oe=s({__name:"UserList",setup(e){const t=a(),r=a([{key:"id",label:"ID",width:100},{key:"username",label:"Username",minWidth:100},{key:"roles",label:"Roles",minWidth:100,render:({row:e})=>e.roles.map((e=>F(L,{size:"small",style:{margin:"2px"},type:"info",bordered:!1},{default:()=>e})))},{key:"disabled",label:"Availability",width:"100px",formatter:e=>e.row.disabled?"Disabled":"Enable"},{key:"created_at",label:"Created At",width:"180px",formatter:e=>T(e.row.created_at)},{key:"updated_at",label:"Updated At",width:"180px",formatter:e=>T(e.row.updated_at)},{label:"Action",key:"actions",width:70,fixed:"right",render:({row:e})=>((e=[],a)=>F(O,{options:e,props:a}))([{label:"Edit",props:{onClick:()=>{c.value=!1,p.value=!0,g.value=m(e)}}},{label:"Delete",props:{onClick:()=>{window.$dialog.confirm(`Are you sure you want to delete ${e.username}? This action is not recoverable!`,"Confirm Delete",{type:"warning"}).then((()=>{w(e.id)})).catch()}}}],{})}]),s=a([{cols:4,children:[{key:"id",type:V.INPUT,props:{placeholder:"Filter ID",clearable:!0}},{key:"username",type:V.INPUT,props:{placeholder:"Filter Username",clearable:!0}},{key:"roles",type:V.SELECT,options:se,props:{multiple:!0,placeholder:"Filter Roles",clearable:!0}},{key:"disabled",type:V.SELECT,options:ne,props:{placeholder:"Filter Availability",clearable:!0}}]}]),p=a(!1),c=a(!1),m=(e={})=>({id:e.id||"",username:e.username||"",password:e.password||"",roles:e.roles||[],disabled:e.disabled||!1}),g=a(m()),v=D((()=>({username:[{required:!0,trigger:["blur"]}],password:[{required:c.value,trigger:["blur"]}],roles:[{validator:(e,a)=>0!==a.length||new Error("Please select at least one role"),required:!0,trigger:["change"]}]}))),y=D((()=>[{type:V.INPUT,key:"username",label:"Username"},{type:V.INPUT,key:"password",label:"Password",props:{type:"password",showPassword:!0,placeholder:c.value?"Please input password":"Optional to update password"}},{type:V.SELECT,key:"roles",label:"Roles",props:{multiple:!0},options:se},{type:V.SELECT,key:"disabled",label:"Availability",options:ne,props:{}}]));l(p,(e=>{e||(g.value=m())}));const C=()=>{c.value=!0,p.value=!0},w=async e=>{try{await $.deleteUser(e),window.$message.success("Delete success")}catch(a){console.error(a)}finally{t.value.isUpdating=!1,await t.value.loadData()}},k=a(!1),z=async()=>{try{k.value=!0,c.value?(await $.createUser(g.value),window.$message.success("Create success")):(await $.updateUser(g.value),window.$message.success("Update success")),p.value=!1,await t.value.loadData()}catch(e){console.error(e)}finally{k.value=!1}};return(e,a)=>{const l=f,m=P;return n(),o(d,null,[i(te,{ref_key:"autoListRef",ref:t,"table-columns":h(r),filterFormItems:h(s),"request-data-fn":h($).getUsers,"enable-pagination":""},{actionsMore:u((()=>[i(l,{type:"primary",onClick:C},{default:u((()=>[j("Create")])),_:1})])),_:1},8,["table-columns","filterFormItems","request-data-fn"]),i(m,{title:h(c)?"Create User":"Edit User",modelValue:h(p),"onUpdate:modelValue":a[0]||(a[0]=e=>b(p)?p.value=e:null)},{default:u((()=>[i(M,{"is-loading":h(k),"form-schema":{model:h(g),rules:h(v),props:{labelPosition:"top"},formItems:h(y)},onOnSubmit:z},null,8,["is-loading","form-schema"])])),_:1},8,["title","modelValue"])],64)}}});export{oe as default};
